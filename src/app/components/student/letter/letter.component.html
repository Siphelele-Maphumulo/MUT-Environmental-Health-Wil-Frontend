<!-- Loading Spinner -->
<div *ngIf="isLoading" class="loading text-center mt-5">
  <mat-spinner></mat-spinner>
</div>

<!-- Declaration Letter View -->
<div *ngIf="!isLoading && declaration" class="container my-5">
  <div class="letter-container shadow p-4 rounded bg-white">
    <div class="text-center mb-4 text-uppercase">
      <h2 class="text-center" style="color: black">DECLARATION LETTER</h2>
    </div>

    <h6 class="mb-4 text-center" style="color: black">
      WORK INTEGRATED LEARNING <br />
      REPORT BY EMPLOYER <br />
      DECLARATION BY EMPLOYER / SUPERVISOR
    </h6>

    <div class="mb-3 row">
      <div class="col-md-6">
        <strong>Student Number:</strong> {{ declaration.student_number }}
      </div>
      <div class="col-md-6">
        <strong>Student Name:</strong> {{ declaration.student_name || "N/A" }}
      </div>
    </div>

    <div class="mb-3 row">
      <div class="col-md-6">
        <strong>Supervisor:</strong> {{ declaration.supervisor_name }}
      </div>
      <div class="col-md-6">
        <strong>Employer:</strong> {{ declaration.employer }}
      </div>
    </div>

    <div class="mb-3 row">
      <div class="col-md-6">
        <strong>Position:</strong> {{ declaration.position }}
      </div>
      <div class="col-md-6">
        {{ declaration.start_date | date : "longDate" }} -
        {{ declaration.end_date | date : "longDate" }}
      </div>
    </div>

    <div class="mb-4">
      <strong>Evaluation:</strong>
      <div class="row mt-2">
        <div
          class="col-md-6 mb-2"
          *ngFor="let eval of getEvaluations(declaration)"
        >
          <div>
            {{ eval.label }}: <span class="fw-semibold">{{ eval.value }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="mb-4">
      <strong>General Comments:</strong>
      <p class="mt-2">{{ declaration.general_comments || "No comments" }}</p>
    </div>

<div *ngIf="declaration; else loading">
  <div class="row mb-4">
    <div class="col-md-6">
      <strong>Supervisor Signature:</strong><br />
      <div *ngIf="declaration.supervisor_signature; else noSignature">
        <img
          [src]="getSignatureUrl(declaration.supervisor_signature)"
          alt="Supervisor Signature"
          style="max-width: 200px; max-height: 100px; margin-top: 10px; border: 1px solid #ddd; border-radius: 4px;"
          (load)="onSignatureLoad()"
          (error)="onSignatureError($event)"
          class="signature-image"
        />
        <div *ngIf="signatureLoading" class="text-muted small">
          Loading signature...
        </div>
        <div *ngIf="signatureError" class="text-warning small">
          Could not load signature
        </div>
      </div>
      <ng-template #noSignature>
        <div class="text-muted">
          No signature available
        </div>
      </ng-template>
    </div>
    <div class="col-md-6">
      <strong>Submitted Date:</strong><br />
      {{ declaration.submittedDate | date : "longDate" }} <!-- Remove ? here too -->
    </div>
  </div>
</div>

<ng-template #loading>
  <div class="loading-spinner">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading declaration...</p>
  </div>
</ng-template>

    <!-- Action Button -->
    <!-- Print Button -->
    <div class="text-center mt-4 no-print">
      <button
        mat-raised-button
        color="primary"
        (click)="printDeclaration()"
        class="d-flex align-items-center justify-content-center"
      >
        <mat-icon>print</mat-icon>
        <span>Print Declaration</span>
      </button>
    </div>

    <!-- No Data Found -->
    <div *ngIf="!isLoading && !declaration" class="no-data text-center mt-5">
      <p>No declaration letter found for this student.</p>
    </div>
  </div>
</div>
