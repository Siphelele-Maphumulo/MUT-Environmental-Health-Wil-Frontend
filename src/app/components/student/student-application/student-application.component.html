<div class="container-fluid d-flex align-items-center justify-content-center min-vh-100 p-2">
  <div class="login-form-container shadow p-2 p-md-3 rounded w-100">
    <div id="header"></div>
    <div class="container mt-3 mt-md-5">
      <h1 class="text-center mb-3 mb-md-4 h4 h-md-3">
        APPLICATION FORM FOR WORK INTEGRATED LEARNING PLACEMENT
      </h1>

      <form [formGroup]="studentApplicationForm" (ngSubmit)="onSubmit()">
        <!-- Province Selection -->
        <div class="section">
          <h3 class="text-center h5 h-md-4">
            Select Your Province where you reside
          </h3>
          <div class="province-grid">
            <div
              class="province-item"
              *ngFor="let province of provinces"
            >
              <input
                type="radio"
                name="province"
                [value]="province"
                formControlName="province"
                id="{{ province }}"
                class="province-radio"
                [class.is-invalid]="studentApplicationForm.get('province')?.invalid && studentApplicationForm.get('province')?.touched"
              />
              <label [for]="province" class="province-label">{{ province }}</label>
            </div>
          </div>
          <div
            *ngIf="
              studentApplicationForm.get('province')?.invalid &&
              studentApplicationForm.get('province')?.touched
            "
            class="text-danger mt-2"
          >
            <small>{{ getErrorMessage("province") }}</small>
          </div>
        </div>

        <!-- Section A: Personal Information -->
        <div class="section">
          <h2 class="section-title maroon-bg">
            Section A: Personal Information
          </h2>

          <div class="personal-info-responsive">
            <!-- Row 1 -->
            <div class="form-row-responsive">
              <div class="form-group-responsive">
                <label class="form-label">Title</label>
                <select 
                  name="title" 
                  formControlName="title" 
                  required
                  class="form-control-responsive"
                  [class.is-invalid]="studentApplicationForm.get('title')?.invalid && studentApplicationForm.get('title')?.touched"
                >
                  <option value="" disabled selected>Select Title</option>
                  <option value="Mr">Mr</option>
                  <option value="Mrs">Mrs</option>
                  <option value="Ms">Ms</option>
                  <option value="Mx">Mx</option>
                  <option value="Rev">Rev</option>
                  <option value="Hon">Hon</option>
                  <option value="Sir">Sir</option>
                  <option value="Madam">Madam</option>
                </select>
                <div
                  *ngIf="
                    studentApplicationForm.get('title')?.invalid &&
                    studentApplicationForm.get('title')?.touched
                  "
                  class="text-danger"
                >
                  <small>{{ getErrorMessage("title") }}</small>
                </div>
              </div>

              <div class="form-group-responsive">
                <label class="form-label">Initials</label>
                <input
                  type="text"
                  name="initials"
                  formControlName="initials"
                  required
                  maxlength="6"
                  pattern="^[A-Z]+$"
                  class="form-control-responsive"
                />
                <div
                  *ngIf="
                    studentApplicationForm.get('initials')?.invalid &&
                    studentApplicationForm.get('initials')?.touched
                  "
                  class="text-danger"
                >
                  <small>{{ getErrorMessage("initials") }}</small>
                </div>
              </div>

            <!-- Modify the Surname field -->
            <div class="form-group-responsive">
              <label class="form-label">Surname</label>
              <input
                type="text"
                name="surname"
                formControlName="surname"
                required
                pattern="^[A-Za-z]+$"
                class="form-control-responsive"
                (blur)="generateInitials()"
              />
              <div
                *ngIf="
                  studentApplicationForm.get('surname')?.invalid &&
                  studentApplicationForm.get('surname')?.touched
                "
                class="text-danger"
              >
                <small>{{ getErrorMessage("surname") }}</small>
              </div>
            </div>
            </div>

            <!-- Modify the First Names field -->
            <div class="form-group-responsive full-width">
              <label class="form-label"><strong>First Names (in full) *</strong></label>
              <input
                type="text"
                name="firstNames"
                formControlName="firstNames"
                required
                pattern="^[A-Za-z ]+$"
                class="form-control-responsive"
                (blur)="generateInitials()"
              />
              <div
                *ngIf="
                  studentApplicationForm.get('firstNames')?.invalid &&
                  studentApplicationForm.get('firstNames')?.touched
                "
                class="text-danger"
              >
                <small>{{ getErrorMessage("firstNames") }}</small>
              </div>
            </div>

           <!-- Row 2 -->
          <div class="form-row-responsive">
            <!-- Student Number Field -->
            <div class="form-group-responsive">
              <label class="form-label">Student Number</label>
              <input
                type="text"
                name="studentNumber"
                formControlName="studentNumber"
                required
                pattern="^[0-9]{8}$"
                class="form-control-responsive"
                [readonly]="isStudentNumberAutoGenerated"
                (blur)="validateStudentNumberWithEmail()"
              />
              <div class="form-text text-muted" *ngIf="isStudentNumberAutoGenerated">
                <small>Automatically generated from your email address</small>
              </div>
              <div
                *ngIf="
                  studentApplicationForm.get('studentNumber')?.invalid &&
                  studentApplicationForm.get('studentNumber')?.touched
                "
                class="text-danger"
              >
                <small>{{ getErrorMessage("studentNumber") }}</small>
              </div>
              <div *ngIf="studentNumberMismatchError" class="text-danger mt-1">
                <small>{{ studentNumberMismatchError }}</small>
              </div>
            </div>

            <!-- Email Address Field -->
            <div class="form-group-responsive">
              <label class="form-label"><strong>Email Address *</strong></label>
              <input
                type="email"
                name="emailAddress"
                formControlName="emailAddress"
                required
                class="form-control-responsive"
                (blur)="extractStudentNumberFromEmail()"
                (input)="clearStudentNumberMismatchError()"
              />
              <div
                *ngIf="
                  studentApplicationForm.get('emailAddress')?.invalid &&
                  studentApplicationForm.get('emailAddress')?.touched
                "
                class="text-danger"
              >
                <small>{{ getErrorMessage("emailAddress") }}</small>
              </div>
              <div *ngIf="emailWarning" class="text-warning mt-1">
                <small>{{ emailWarning }}</small>
              </div>
            </div>
          </div>

            <!-- Row 3 -->
            <div class="form-row-responsive">
              <div class="form-group-responsive">
                <label class="form-label">Race</label>
                <select name="race" formControlName="race" required class="form-control-responsive">
                  <option value="" disabled selected>Select Race</option>
                  <option value="African">African</option>
                  <option value="White">White</option>
                  <option value="Indian">Indian</option>
                  <option value="Coloured">Coloured</option>
                  <option value="Other">Other</option>
                </select>
                <div
                  *ngIf="
                    studentApplicationForm.get('race')?.invalid &&
                    studentApplicationForm.get('race')?.touched
                  "
                  class="text-danger"
                >
                  <small>{{ getErrorMessage("race") }}</small>
                </div>
              </div>

              <div class="form-group-responsive">
                <label class="form-label">Gender</label>
                <select name="gender" formControlName="gender" required class="form-control-responsive">
                  <option value="" disabled selected>Select Gender</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>
                <div
                  *ngIf="
                    studentApplicationForm.get('gender')?.invalid &&
                    studentApplicationForm.get('gender')?.touched
                  "
                  class="text-danger"
                >
                  <small>{{ getErrorMessage("gender") }}</small>
                </div>
              </div>
            </div>



              <div class="form-group-responsive">
                <label class="form-label">Physical Address</label>
                <input
                  type="text"
                  name="physicalAddress"
                  formControlName="physicalAddress"
                  required
                  pattern="^[A-Za-z0-9 ,.-]+$"
                  class="form-control-responsive"
                />
                <div
                  *ngIf="
                    studentApplicationForm.get('physicalAddress')?.invalid &&
                    studentApplicationForm.get('physicalAddress')?.touched
                  "
                  class="text-danger"
                >
                  <small>{{ getErrorMessage("physicalAddress") }}</small>
                </div>
              </div>
            </div>

            <!-- Row 5 -->
            <div class="form-row-responsive">
              <div class="form-group-responsive">
                <label class="form-label">Cell Phone Number</label>
                <input
                  type="text"
                  name="cellPhoneNumber"
                  formControlName="cellPhoneNumber"
                  required
                  pattern="^[0-9]{10,13}$"
                  class="form-control-responsive"
                />
                <div
                  *ngIf="
                    studentApplicationForm.get('cellPhoneNumber')?.invalid &&
                    studentApplicationForm.get('cellPhoneNumber')?.touched
                  "
                  class="text-danger"
                >
                  <small>{{ getErrorMessage("cellPhoneNumber") }}</small>
                </div>
              </div>

              <div class="form-group-responsive">
                <label class="form-label">Home Town</label>
                <input
                  type="text"
                  name="homeTown"
                  formControlName="homeTown"
                  pattern="^[A-Za-z ]+$"
                  class="form-control-responsive"
                />
                <div
                  *ngIf="
                    studentApplicationForm.get('homeTown')?.invalid &&
                    studentApplicationForm.get('homeTown')?.touched
                  "
                  class="text-danger"
                >
                  <small>{{ getErrorMessage("homeTown") }}</small>
                </div>
              </div>
            </div>
          </div>


        <!-- Section B: Preferred Area of WIL Placement -->
        <div class="section">
          <h2 class="section-title maroon-bg">
            Section B: Preferred Area of WIL Placement
          </h2>
          <div class="choice-header">
            Choice A: Municipal Health Services
          </div>
          
          <div class="personal-info-responsive">
            <!-- Row 1 -->
            <div class="form-row-responsive">
              <div class="form-group-responsive">
                <label class="form-label">Municipality</label>
                <select
                  name="municipalityName"
                  formControlName="municipalityName"
                  class="form-control-responsive"
                >
                  <option value="">Select Municipality</option>
                  <option
                    *ngFor="let municipality of southAfricanMunicipalities"
                    [value]="municipality"
                  >
                    {{ municipality }}
                  </option>
                </select>
                <div
                  *ngIf="
                    studentApplicationForm.get('municipalityName')?.invalid &&
                    studentApplicationForm.get('municipalityName')?.touched
                  "
                  class="text-danger"
                >
                  <small>{{ getErrorMessage("municipalityName") }}</small>
                </div>
              </div>

              <div class="form-group-responsive">
                <label class="form-label">Town Situated</label>
                <select
                  name="townSituated"
                  formControlName="townSituated"
                  class="form-control-responsive"
                  required
                >
                  <option value="">Select Town</option>
                  <option *ngFor="let town of southAfricanTowns" [value]="town">
                    {{ town }}
                  </option>
                </select>
                <div
                  *ngIf="
                    studentApplicationForm.get('townSituated')?.invalid &&
                    studentApplicationForm.get('townSituated')?.touched
                  "
                  class="text-danger"
                >
                  <small>{{ getErrorMessage("townSituated") }}</small>
                </div>
              </div>
            </div>

            <!-- Row 2 -->
            <div class="form-row-responsive">
              <div class="form-group-responsive">
                <label class="form-label">Contact Person</label>
                <input
                  type="text"
                  name="contactPerson"
                  formControlName="contactPerson"
                  class="form-control-responsive"
                />
                <div
                  *ngIf="
                    studentApplicationForm.get('contactPerson')?.invalid &&
                    studentApplicationForm.get('contactPerson')?.touched
                  "
                  class="text-danger"
                >
                  <small>{{ getErrorMessage("contactPerson") }}</small>
                </div>
              </div>

              <div class="form-group-responsive">
                <label class="form-label">Email Address</label>
                <input
                  type="text"
                  name="contactEmail"
                  formControlName="contactEmail"
                  pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
                  class="form-control-responsive"
                />
                <div
                  *ngIf="
                    studentApplicationForm.get('contactEmail')?.invalid &&
                    studentApplicationForm.get('contactEmail')?.touched
                  "
                  class="text-danger"
                >
                  <small>{{ getErrorMessage("contactEmail") }}</small>
                </div>
              </div>
            </div>

            <!-- Row 3 -->
            <div class="form-row-responsive">
              <div class="form-group-responsive">
                <label class="form-label">Telephone Number</label>
                <input
                  type="text"
                  name="telephoneNumber"
                  formControlName="telephoneNumber"
                  pattern="^[0-9]{10,13}$"
                  class="form-control-responsive"
                />
                <div
                  *ngIf="
                    studentApplicationForm.get('telephoneNumber')?.invalid &&
                    studentApplicationForm.get('telephoneNumber')?.touched
                  "
                  class="text-danger"
                >
                  <small>{{ getErrorMessage("telephoneNumber") }}</small>
                </div>
              </div>

              <div class="form-group-responsive">
                <label class="form-label">Cell Phone</label>
                <input
                  type="text"
                  name="contactCellPhone"
                  formControlName="contactCellPhone"
                  pattern="^[0-9]{10,13}$"
                  class="form-control-responsive"
                />
                <div
                  *ngIf="
                    studentApplicationForm.get('contactCellPhone')?.invalid &&
                    studentApplicationForm.get('contactCellPhone')?.touched
                  "
                  class="text-danger"
                >
                  <small>{{ getErrorMessage("contactCellPhone") }}</small>
                </div>
              </div>
            </div>
          </div>
          <!-- Add validation message for duplicate phone numbers -->
          <!-- Add validation message for duplicate phone numbers -->
          <div
            *ngIf="studentApplicationForm.hasError('duplicatePhoneNumbers')"
            class="text-danger mt-2"
          >
            <small>Cell Phone Number and Contact Cell Phone cannot be the same</small>
          </div>
          
          <div class="centered mt-3">
            <strong class="note-text">
              Note: Applicants are not responsible for their own travel and
              accommodation during WIL placement.
            </strong>
          </div>
        </div>

        <!-- Section C: Declaration -->
        <div class="section">
          <h2 class="section-title maroon-bg">Section C: Declaration</h2>
          <div class="declaration-responsive">
            <div class="declaration-header">
              <span class="declaration-text">I DECLARE THE FOLLOWING</span>
              <span class="declaration-tick">Tick</span>
            </div>
            
            <div class="declaration-item">
              <span class="declaration-text">
                The information in the application is true and correct
              </span>
              <span class="declaration-tick">
                <input
                  type="checkbox"
                  name="declarationInfo1"
                  formControlName="declarationInfo1"
                  class="declaration-checkbox"
                />
              </span>
            </div>
            
            <div class="declaration-item">
              <span class="declaration-text">
                Preferred area of WIL has been communicated with my Parents or Guardians
              </span>
              <span class="declaration-tick">
                <input
                  type="checkbox"
                  name="declarationInfo2"
                  formControlName="declarationInfo2"
                  class="declaration-checkbox"
                />
              </span>
            </div>
            
            <div class="declaration-item">
              <span class="declaration-text">
                I know no reason that could prevent me from attending WIL sessions or from successfully completing the specified period
              </span>
              <span class="declaration-tick">
                <input
                  type="checkbox"
                  name="declarationInfo3"
                  formControlName="declarationInfo3"
                  class="declaration-checkbox"
                />
              </span>
            </div>
          </div>
          
          <div
            *ngFor="
              let control of [
                'declarationInfo1',
                'declarationInfo2',
                'declarationInfo3'
              ]
            "
          >
            <div
              *ngIf="
                studentApplicationForm.get(control)?.invalid &&
                studentApplicationForm.get(control)?.touched
              "
              class="text-danger mt-2"
            >
              <small>{{ getErrorMessage(control) }}</small>
            </div>
          </div>
        </div>

        <!-- Rules for Application -->
        <div class="section">
          <h2 class="bold centered h5">Rules for Application</h2>
          <ul class="bullet-points">
            <li>Incomplete forms will not be accepted</li>
            <li>Forms must be submitted before the closing date</li>
            <li>Provide certified ID and CV</li>
            <li>Attend all compulsory WIL sessions</li>
          </ul>
        </div>

        <!-- Signature Section -->
        <div class="section">
          <h2 class="section-title maroon-bg text-center">
            Signature and Document Uploads
          </h2>
          <div class="upload-container">
            <!-- Signature Upload -->
            <div class="file-upload-group">
              <label for="signatureImage" class="file-label"
                >Upload Signature (Image) *</label
              >
              <input
                type="file"
                name="signatureImage"
                id="signatureImage"
                formControlName="signatureImage"
                accept="image/*"
                (change)="onFileChange($event, 'signatureImage')"
                aria-label="Upload Signature Image"
                required
              />
              <div
                *ngIf="
                  studentApplicationForm.get('signatureImage')?.invalid &&
                  studentApplicationForm.get('signatureImage')?.touched
                "
                class="text-danger"
              >
                <small>{{ getErrorMessage("signatureImage") }}</small>
              </div>
            </div>

            <!-- ID Document Upload -->
            <div class="file-upload-group">
              <label for="idDocument" class="file-label"
                >Upload ID Document *</label
              >
              <input
                type="file"
                name="idDocument"
                id="idDocument"
                formControlName="idDocument"
                accept=".pdf,.jpg,.jpeg,.png"
                (change)="onFileChange($event, 'idDocument')"
                aria-label="Upload ID Document"
                required
              />
              <div
                *ngIf="
                  studentApplicationForm.get('idDocument')?.invalid &&
                  studentApplicationForm.get('idDocument')?.touched
                "
                class="text-danger"
              >
                <small>{{ getErrorMessage("idDocument") }}</small>
              </div>
            </div>

            <!-- CV Upload -->
            <div class="file-upload-group">
              <label for="cvDocument" class="file-label"
                >Upload CV (PDF) *</label
              >
              <input
                type="file"
                name="cvDocument"
                id="cvDocument"
                formControlName="cvDocument"
                accept=".pdf"
                (change)="onFileChange($event, 'cvDocument')"
                aria-label="Upload CV Document"
                required
              />
              <div
                *ngIf="
                  studentApplicationForm.get('cvDocument')?.invalid &&
                  studentApplicationForm.get('cvDocument')?.touched
                "
                class="text-danger"
              >
                <small>{{ getErrorMessage("cvDocument") }}</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="section centered button-container-responsive">
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="studentApplicationForm.invalid || isSubmitting"
            aria-label="Submit Application"
            class="submit-btn"
          >
            <span *ngIf="!isSubmitting">Submit Application</span>
            <span
              *ngIf="isSubmitting"
              class="spinner-border spinner-border-sm"
              role="status"
              aria-hidden="true"
            ></span>
            <span *ngIf="isSubmitting"> Submitting...</span>
          </button>
          <button
            mat-raised-button
            color="warn"
            type="button"
            (click)="goBack()"
            aria-label="Cancel Application"
            class="cancel-btn"
          >
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>