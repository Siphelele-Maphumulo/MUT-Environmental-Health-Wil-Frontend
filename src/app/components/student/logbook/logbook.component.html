<div class="main-content">
  <h1
    style="
      margin-top: -90px;
      font-size: 30pt;
      font-weight: 600;
      text-align: center;
    "
  >
      Logbook of {{ studentNumber }}
  

    <div class="totals-section">
      <p><strong>Total Hours Worked:</strong> {{ totalHoursWorked }}</p>
      <p><strong>Total Days Worked:</strong> {{ totalDaysWorked }}</p>
    </div>
  </h1>

  <div *ngIf="isLoading" class="loading-spinner">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading logsheets...</p>


    <div class="totals-section">
      <p><strong>Total Hours Worked:</strong> {{ totalHoursWorked }}</p>
      <p><strong>Total Days Worked:</strong> {{ totalDaysWorked }}</p>
    </div>
  </div>

  <div *ngIf="isLoading" class="loading-spinner">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading logsheets...</p>
  </div>

  <!-- Filter Section -->
  <div class="filter-section">
    <div class="filter-row">
      <!-- Log Date Filter -->
      <mat-form-field appearance="outline">
        <mat-label>Log Date</mat-label>
        <input
          matInput
          [matDatepicker]="logDatePicker"
          [formControl]="logDateControl"
          placeholder="Select log date"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="logDatePicker"
        ></mat-datepicker-toggle>
        <mat-datepicker #logDatePicker></mat-datepicker>
      </mat-form-field>

      <!-- Signature Status Filter -->
      <mat-form-field appearance="outline" class="signature-filter">
        <mat-label>Supervisor Status</mat-label>
        <mat-select
          [formControl]="signatureFilterControl"
          (selectionChange)="applyFilters()"
        >
          <mat-option value="all">All</mat-option>
          <mat-option value="signed">Signed</mat-option>
          <mat-option value="unsigned">Not Signed</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Date Stamp Filter -->
      <mat-form-field appearance="outline">
        <mat-label>Date Stamp</mat-label>
        <input
          matInput
          [matDatepicker]="dateStampPicker"
          [formControl]="dateStampControl"
          placeholder="Select date"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="dateStampPicker"
        ></mat-datepicker-toggle>
        <mat-datepicker #dateStampPicker></mat-datepicker>
      </mat-form-field>

      <!-- Clear Filters Button -->
      <button
        mat-stroked-button
        color="warn"
        (click)="clearFilters()"
        class="clear-btn"
      >
        <mat-icon>clear_all</mat-icon>
        Clear Filters
      </button>
    </div>
  </div>

  <div *ngIf="!isLoading" class="table-container">
    <table
      mat-table
      [dataSource]="filteredLogSheets"
      class="table-scaling-container"
    >
      <!-- Student Number Column -->
      <ng-container matColumnDef="studentNumber">
        <th mat-header-cell *matHeaderCellDef>Student Number</th>
        <td mat-cell *matCellDef="let log">{{ log.student_number }}</td>
      </ng-container>

      <!-- Date Column -->
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef>Date</th>
        <td mat-cell *matCellDef="let log">
          {{ log.log_date | date : "mediumDate" }}
        </td>
      </ng-container>

      <!-- Activities Column -->
      <ng-container matColumnDef="activities">
        <th mat-header-cell *matHeaderCellDef>Activities</th>
        <td mat-cell *matCellDef="let log">
          <div *ngFor="let activity of log.activities">
            {{ activity.name }} ({{ activity.hours }} hrs)
          </div>
        </td>
      </ng-container>

      <!-- Description Column -->
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef>Description</th>
        <td mat-cell *matCellDef="let log" class="wrap-text">
          {{ log.description }}
        </td>
      </ng-container>

      <!-- Situation Description Column -->
      <ng-container matColumnDef="situationDescription">
        <th mat-header-cell *matHeaderCellDef>Situation Description</th>
        <td mat-cell *matCellDef="let log" class="wrap-text">
          {{ log.situation_description }}
        </td>
      </ng-container>

      <!-- Situation Evaluation Column -->
      <ng-container matColumnDef="situationEvaluation">
        <th mat-header-cell *matHeaderCellDef>Situation Evaluation</th>
        <td mat-cell *matCellDef="let log" class="wrap-text">
          {{ log.situation_evaluation }}
        </td>
      </ng-container>

      <!-- Situation Interpretation Column -->
      <ng-container matColumnDef="situationInterpretation">
        <th mat-header-cell *matHeaderCellDef>Situation Interpretation</th>
        <td mat-cell *matCellDef="let log" class="wrap-text">
          {{ log.situation_interpretation }}
        </td>
      </ng-container>

      <!-- EHP HI Number Column -->
      <ng-container matColumnDef="EHP_HI_Number">
        <th mat-header-cell *matHeaderCellDef>EHP HI Number</th>
        <td mat-cell *matCellDef="let log" class="wrap-text">
          {{ log.EHP_HI_Number || "N/A" }}
        </td>
      </ng-container>

      <!-- Date Stamp Column -->
      <ng-container matColumnDef="dateStamp">
        <th mat-header-cell *matHeaderCellDef>Date Stamp</th>
        <td mat-cell *matCellDef="let log">
          {{ log.date_stamp | date : "yyyy-MM-dd" }}
        </td>
      </ng-container>

      <!-- Student Signature Column -->
      <ng-container matColumnDef="student_signature">
        <th mat-header-cell *matHeaderCellDef>Student Signature</th>
        <td mat-cell *matCellDef="let log">
          <ng-container *ngIf="log.student_signature; else noStudentSignature">
            <img
              [src]="log.safeStudentSignature || getSafeUrl(log.student_signature, log.student_number)"
              alt="Student Signature"
              class="signature-image"
            />
          </ng-container>
          <ng-template #noStudentSignature>
            Not Signed
          </ng-template>
        </td>
      </ng-container>

      <!-- Supervisor Signature Column -->
      <ng-container matColumnDef="supervisor_signature">
        <th mat-header-cell *matHeaderCellDef>Supervisor Signature</th>
        <td mat-cell *matCellDef="let log">
          <ng-container *ngIf="log.supervisor_signature; else notSigned">
            <img
              [src]="log.safeSupervisorSignature || getSafeUrl(log.supervisor_signature, log.student_number)"
              alt="Supervisor Signature"
              class="signature-image"
              (click)="downloadSignature(log.supervisor_signature, 'supervisor', log.student_number)"
              style="cursor: pointer"
            />
          </ng-container>
          <ng-template #notSigned>
            Not Signed
          </ng-template>
        </td>
      </ng-container>

      <!-- Table Rows -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
</div>